{"version":3,"sources":["lib.js"],"names":[],"mappings":"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","file":"lib.js","sourcesContent":["const interp = require('./interp')\nconst C = require('./constants')\nconst equal = require('deep-equal')\n\nexport class StringPrim {\n  constructor(str) {\n    this.str = str\n  }\n\n  set str(str) {\n    this._str = String(str)\n  }\n\n  get str() {\n    return String(this._str)\n  }\n\n  toString() {\n    return '<String ' + this.str + '>'\n  }\n}\n\nexport class BooleanPrim {\n  constructor(bool) {\n    this.bool = bool\n  }\n\n  set bool(bool) {\n    this._bool = Boolean(bool)\n  }\n\n  get bool() {\n    return Boolean(this._bool)\n  }\n\n  valueOf() {\n    return this.bool\n  }\n\n  toString() {\n    return `<Boolean ${this.bool}>`\n  }\n}\n\nexport class NumberPrim {\n  constructor(num) {\n    this.num = num\n  }\n\n  set num(num) {\n    this._num = Number(num)\n  }\n\n  get num() {\n    return Number(this._num)\n  }\n\n  valueOf() {\n    return this.num\n  }\n\n  toString() {\n    return '<Number ' + this.num + '>'\n  }\n}\n\n// Converting language primatives to JS prims ---------------------------------\n\nexport function toJString(str) {\n  if (str instanceof StringPrim) {\n    return str.str\n  } else {\n    return String(str)\n  }\n}\n\nexport function toJBoolean(bool) {\n  if (bool instanceof BooleanPrim && bool.bool === true) {\n    return true\n  } else {\n    return false\n  }\n}\n\nexport function toJNumber(num) {\n  if (num instanceof NumberPrim) {\n    return num.num\n  } else {\n    return Number(num)\n  }\n}\n\n// Converting JS prims to language primitives ---------------------------------\n\nexport function toLString(str) {\n  return new StringPrim(str)\n}\n\nexport function toLBoolean(bool) {\n  return new BooleanPrim(bool)\n}\n\nexport function toLNumber(num) {\n  return new NumberPrim(num)\n}\n\nexport function toLObject(data) {\n  let obj = new LObject()\n  for (let key in data) {\n    set(obj, key, data[key])\n  }\n  return obj\n}\n\n// Tree parsing stuff ---------------------------------------------------------\n\nexport function searchTreeFor(innerTree, searchFor, reject) {\n  for (let treeNode of innerTree) {\n    if (equal(treeNode, searchFor)) {\n      return true\n    }\n  }\n  for (let treeNode of innerTree.filter(n => n instanceof Array)\n        .filter(n => !(reject ? reject(n) : false))) {\n    if (searchTreeFor(treeNode, searchFor, reject)) {\n      return true\n    }\n  }\n  return false\n}\n\n// Call function --------------------------------------------------------------\n\nexport async function call(fn, args) {\n  return await fn['__call__'](args)\n}\n\nexport async function defaultCall(fnToken, args) {\n  if (fnToken.fn instanceof Function) {\n    // it's a javascript function so just call it\n    const argumentValues = []\n    for (let argument of args) {\n      argumentValues.push(await interp.evaluateExpression(\n        argument, fnToken.argumentScope))\n    }\n    let ret = fnToken.fn(argumentValues)\n    if (ret instanceof Promise) {\n      return await ret\n    } else {\n      return ret\n    }\n  } else {\n    // Might this function return anything? We can tell by if the `return`\n    // variable is referenced anywhere within the function's code. If so we\n    // need to do all sorts of promise-y things.\n    //\n    // Of course, this is all very hacky, and we would be better off using an\n    // \"async {}\" asynchronous function syntax...\n    /*\n    const isAsynchronous = searchTreeFor(\n      fnToken.fn, ['VARIABLE_IDENTIFIER', 'return'],\n      // New function literals get a new return, so ignore those\n      n => n[0] === 'FUNCTION_PRIM')\n    console.log('test:', isAsynchronous)\n    */\n    const isAsynchronous = fnToken.isAsynchronous\n\n    // Asynchronous things\n    let resolve\n    const donePromise = new Promise(function(_resolve) {\n      resolve = _resolve\n    })\n\n    // Not asynchronous things\n    let returnValue = null\n\n    const scope = Object.assign({}, fnToken.environment.vars)\n    scope.return = new Variable(new LFunction(function([val]) {\n      if (isAsynchronous) {\n        resolve(val)\n      } else {\n        returnValue = val\n      }\n    }))\n    const paramaters = fnToken.paramaterList\n    for (let i = 0; i < paramaters.length; i++) {\n      const value = args[i]\n      const paramater = paramaters[i]\n      if (paramater.type === 'normal') {\n        const evaluatedValue = await interp.evaluateExpression(value)\n        scope[paramater.name] = new Variable(evaluatedValue)\n      } else if (paramater.type === 'unevaluated') {\n        scope[paramater.name] = new Variable(new LFunction(async function() {\n          return await interp.evaluateExpression(value, fnToken.argumentScope)\n        }))\n      }\n    }\n\n    const environment = new LEnvironment()\n    environment.comment = 'Calling environment'\n    environment.parentEnvironment = fnToken.environment.parentEnvironment\n    Object.assign(environment.vars, scope)\n\n    // Shorthand functions.. these aren't finished! They don't work with the\n    // whole async stuff. I think.\n    if (fnToken.isShorthand) {\n      return await interp.evaluateExpression(fnToken.fn, environment)\n    } else {\n      await interp.evaluateEachExpression(fnToken.fn, environment)\n      if (isAsynchronous) {\n        return await donePromise\n      } else {\n        return returnValue\n      }\n    }\n  }\n}\n\n// Has function ---------------------------------------------------------------\n\nexport function has(obj, key) {\n  return key in obj\n}\n\n// Get function ---------------------------------------------------------------\n\nexport function get(obj, key) {\n  return obj['__get__'](key)\n}\n\nexport function defaultGet(obj, key) {\n  let keyString = toJString(key)\n  if (obj.data.hasOwnProperty(keyString)) {\n    return obj.data[keyString]\n  } else {\n    let constructor = obj['__constructor__']\n    let prototype = constructor['__prototype__']\n    let current = constructor\n    while (current && prototype && !(key in prototype)) {\n      current = current['__super__']\n      prototype = current ? current['__prototype__'] : null\n    }\n    if (current) {\n      let value = prototype[keyString]\n      if (value instanceof LFunction) {\n        // I was going to just bind to obj, but that generally involves using\n        // the oh so terrible `this`.\n        // Instead it returns a function that calls the given function with\n        // obj as the first paramater.\n        return new LFunction(function(...args) {\n          return value.fn(obj, ...args)\n        })\n      }\n      return value\n    }\n  }\n}\n\n// Set function ---------------------------------------------------------------\n\nexport function set(obj, key, value) {\n  return obj['__set__'](key, value)\n}\n\nexport function defaultSet(obj, key, value) {\n  return obj.data[toJString(key)] = value\n}\n\n// Variable class -------------------------------------------------------------\n// * this should never *ever* be accessed through anywhere except set/get\n//   Variable functions\n// * takes one paramater, value, which is stored in inst.value and represents\n//   the value of the Variable\nexport class Variable {\n  constructor(value) {\n    this.value = value\n  }\n\n  toString() {\n    return '<Variable>'\n  }\n}\n\n// Base token class -----------------------------------------------------------\n// * doesn't do anything on its own\n// * use x instanceof Token to check if x is any kind of token\n\nexport class Token {\n  constructor() {}\n}\n\n// Object token class ---------------------------------------------------------\n\nexport class LObject extends Token {\n  constructor() {\n    super()\n    this.data = {}\n    this['__constructor__'] = LObject\n  }\n\n  __get__(key) {\n    return defaultGet(this, key)\n  }\n\n  __set__(key, value) {\n    return defaultSet(this, key, value)\n  }\n}\n\nexport class LArray extends LObject {\n  constructor() {\n    super()\n    this['__constructor__'] = LArray\n    this.data.length = 0\n  }\n}\n\n// Function token class -------------------------------------------------------\n// [[this needs to be rewritten]]\n// * takes one paramater, fn, which is stored in inst.fn and represents the\n//     function that will be called\n// * you can also set scopeVariables (using setScopeVariables), which is\n//     generally only used for internal creation of function expressions; it\n//     represents the closure Variables that can be accessed from within the\n//     function\n// * you can also set fnArguments (using setArguments), which is generally also\n//     only used for internal creation of function expressions; it tells what\n//     call arguments should be mapped to in the Variables context of running\n//     the code block\n// * use inst.__call__ to call the function (with optional arguments)\n\nexport class LFunction extends LObject {\n  constructor(fn, asynchronous) {\n    super()\n    this['__constructor__'] = LFunction\n    this.fn = fn\n    this.environment = null\n\n    this.unevaluatedArgs = []\n    this.normalArgs = []\n    if (asynchronous) this.isAsynchronous = true\n  }\n\n  __call__(args) {\n    // Call this function. By default uses defaultCall, but can be overriden\n    // by subclasses.\n    return defaultCall(this, args)\n  }\n\n  setParamaters(paramaterList) {\n    this.paramaterList = paramaterList\n  }\n\n  toString() {\n    return '<Function>'\n  }\n}\n\nlet environmentCount = 0\n\nexport class LEnvironment {\n  constructor() {\n    this['__constructor__'] = LEnvironment\n    this.vars = {}\n    this.breakToEnvironment = null\n    this.comment = ''\n    this.environmentNum = (environmentCount++)\n  }\n\n  addVars(variables) {\n    for (const name of Object.getOwnPropertyNames(variables)) {\n      this.vars[name] = variables[name]\n    }\n    // console.log('Des vars addid :)', Object.getOwnPropertyNames(variables))\n  }\n\n  __set__(variableName, value) {\n    this.vars[variableName] = new Variable(value)\n  }\n\n  __get__(variableName) {\n    return this.vars[variableName].value\n  }\n\n  toString() {\n    // return JSON.stringify(Object.keys(this.vars))\n    return `<Environment #${this.environmentNum} \"${this.comment}\">`\n  }\n}\n\n// ETC. that requires above definitions ---------------------------------------\n\nexport let LObjectPrototype = {}\n\nexport let LArrayPrototype = {\n  push: new LFunction(function(self, what) {\n    self.data[self.data.length] = what\n    self.data.length = self.data.length + 1\n  }),\n  pop: new LFunction(function(self) {\n    delete self.data[self.data.length - 1]\n    self.data.length = self.data.length - 1\n  })\n}\n\nexport let LFunctionPrototype = {\n  debug: new LFunction(function(self) {\n    console.log('** DEBUG **')\n    console.log(self.fn.toString())\n  })\n}\n\nLObject['__prototype__'] = LObjectPrototype\nLObject['__super__'] = null\n\nLArray['__prototype__'] = LArrayPrototype\nLArray['__super__'] = LObject\n\nLFunction['__prototype__'] = LFunctionPrototype\nLFunction['__super__'] = LObject\n"],"sourceRoot":"/source/"}